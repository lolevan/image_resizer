# Веб-сервис для изменения размера и сжатия изображений

## Описание

Компания "Забавные Картинки" решила создать веб-сервис для изменения изображений, чтобы упростить обработку фотографий для своих клиентов. Их клиенты - любители фотографии, которые хотят быстро изменить размер и сжать свои фотографии, а также добавить к ним водяной знак с логотипом компании. 

Цель: разработать веб-сервис, предоставляющий API для изменения размера и сжатия изображений с добавлением водяного знака (watermark).

## Функциональные требования

- Принимает на вход изображение в формате JPEG, PNG, GIF, BMP.
- Поддерживает следующие операции:
  1. Изменение размера (указание ширины и/или высоты, сохранение пропорций).
  2. Сжатие (указание качества сжатия).
  3. Добавление водяного знака (указание изображения водяного знака, позиции, прозрачности).
- Возвращает измененное изображение в формате по выбору пользователя.
- Предусмотреть возможность аутентификации пользователей с помощью API-ключа.
- Использовать библиотеку Pillow для обработки изображений.
- Офлоад обработки изображений в отдельные процессы от API с помощью Celery и Redis, чтобы не блокировать главный поток и обеспечить быструю обработку запросов.
- Вести логи всех запросов к API с информацией о параметрах обработки, времени обработки и результате.

## Технологии

- Веб-фреймворк: FastAPI.
- Библиотека обработки изображений: Pillow.
- Язык программирования: Python.
- База данных: PostgreSQL.
- Очередь задач: Celery.
- Брокер сообщений: Redis.

## Запуск проекта

### Предварительные требования

- Docker
- Docker Compose

### Шаги для запуска

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/lolevan/image_resizer.git
    cd image_resizer
    ```

2. Создайте и запустите контейнеры:

    ```bash
    docker-compose up --build
    ```

3. Приложение будет доступно по адресу: [http://127.0.0.1:8000](http://127.0.0.1:8000)

### Документация API

Документация API с использованием Swagger доступна по адресу: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

## Веб-интерфейс

Простой веб-интерфейс для тестирования API доступен по адресу: [http://127.0.0.1:8000](http://127.0.0.1:8000)

## Эндпоинты API

### Получение API-ключа

- **URL**: `/get_api_key`
- **Метод**: GET
- **Описание**: Возвращает HTML-страницу для получения API-ключа.

### Создание API-ключа

- **URL**: `/create_key/`
- **Метод**: POST
- **Параметры**:
  - `user` (string): Имя пользователя
- **Описание**: Создает и возвращает API-ключ для пользователя.

### Обработка изображения

- **URL**: `/process_image/`
- **Метод**: POST
- **Параметры**:
  - `image` (file): Изображение для обработки
  - `width` (int, optional): Новая ширина изображения
  - `height` (int, optional): Новая высота изображения
  - `quality` (int, optional): Качество сжатия (1-100)
  - `watermark` (file, optional): Водяной знак для добавления
  - `position` (string, optional): Позиция водяного знака (`center`, `top_left`, `top_right`, `bottom_left`, `bottom_right`)
  - `transparency` (int, optional): Прозрачность водяного знака (0-255)
- **Описание**: Обрабатывает изображение в соответствии с заданными параметрами и возвращает обработанное изображение.

## Логи

Все запросы к API и информация о параметрах обработки, времени обработки и результате ведутся в лог-файл `image_processing.log` и `api.log`.

## Выполненные задачи

Все функциональные требования и задачи, указанные в тестовом задании, были выполнены, включая:

- Прием изображений в формате JPEG, PNG, GIF, BMP.
- Изменение размера и сжатие изображений.
- Добавление водяного знака с указанием изображения, позиции и прозрачности.
- Возвращение измененного изображения в формате по выбору пользователя.
- Аутентификация пользователей с помощью API-ключа.
- Использование библиотеки Pillow для обработки изображений.
- Офлоад обработки изображений в отдельные процессы от API с помощью Celery и Redis.
- Ведение логов всех запросов к API.

## Затраченное время

На выполнение данного проекта было затрачено приблизительно 6 часов.

## Контакты

Для вопросов и предложений, пожалуйста, свяжитесь с нами по адресу: [vanechka.nikitin.20044@gmail.com]
